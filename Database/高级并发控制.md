## 在线索引创建

先做一个快照，然后创建索引，然后给索引更新上一个共享锁，应用这些更新。

## 索引结构中的并发

### crabbing protocol

获取当前节点的s锁，获得子节点的锁后，释放当前的锁，搞到目标节点的x锁，如果安全，释放父节点的锁，不安全的话就不释放了

### B-link Tree

这种方法的并发程序更高，甚至申请锁的时候不必持有另一把锁，释放了再去申请

### 键值锁

next-key lock, gap lock 可以有效防止幻读

## latch-free data structure

使用CAS技术，CAS(var, oldvar, newvar) , 不过可能会有ABA问题，比如说P1要删掉链表的第一个节点A，而与此同时P2删掉了A和B，那么P1再次插入A的时候，A会指向B！但是B已经不存在了，因此，我们可以为每个指针保留一个计数器